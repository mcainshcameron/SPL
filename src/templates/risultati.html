{% extends "base.html" %}
{% set active_page = 'risultati' %}

{% block title %}Risultati - SPL{% endblock %}

{% block content %}
<section class="section">
    <h1>Risultati</h1>
    
    <!-- Filters -->
    <div class="filters">
        <div class="filter-group">
            <label>Campionato:</label>
            <select id="championshipFilter" class="filter-select">
                <option value="">Tutti</option>
                {% for champ in championships %}
                <option value="{{ champ }}">{{ champ }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="filter-group">
            <label>Stagione:</label>
            <select id="seasonFilter" class="filter-select">
                <option value="">Tutte</option>
                {% for season in seasons %}
                <option value="{{ season }}">Stagione {{ season }}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!-- Games List -->
    <div class="games-list">
        {% for game in games %}
        <details class="game-card" data-championship="{{ game.Championship }}" data-season="{{ game.Season }}">
            <summary class="game-summary">
                <div class="game-info">
                    <span class="game-championship-badge">{{ game.Championship }}</span>
                    <span class="game-date">{{ game.Date[:10] }}</span>
                    <span class="game-meta">S{{ game.Season }} W{{ game.Gameweek }} â€¢ {{ game['Match Type'] }}</span>
                </div>
                <div class="game-score-summary">
                    <span class="score">{{ game['Team A Goals'] }} - {{ game['Team B Goals'] }}</span>
                </div>
            </summary>
            <div class="game-details">
                <div class="game-teams">
                    <div class="team {% if game['Winning Team'] == 'Team A' %}winner{% endif %}">
                        <div class="team-label">Team A</div>
                        <div class="team-score">{{ game['Team A Goals'] }}</div>
                    </div>
                    <div class="vs">vs</div>
                    <div class="team {% if game['Winning Team'] == 'Team B' %}winner{% endif %}">
                        <div class="team-label">Team B</div>
                        <div class="team-score">{{ game['Team B Goals'] }}</div>
                    </div>
                </div>
                
                {% if game.get('team_a_players') or game.get('team_b_players') %}
                <div class="team-compositions">
                    <div class="team-roster">
                        <h4>Team A</h4>
                        <div class="roster-list">
                            {% for player in game.get('team_a_players', []) %}
                            <div class="roster-player-item">
                                <a href="/players/{{ player.slug }}/">{{ player.name }}</a>
                                {% if player.goals > 0 %}
                                <span class="player-goals">âš½ {{ player.goals }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="team-roster">
                        <h4>Team B</h4>
                        <div class="roster-list">
                            {% for player in game.get('team_b_players', []) %}
                            <div class="roster-player-item">
                                <a href="/players/{{ player.slug }}/">{{ player.name }}</a>
                                {% if player.goals > 0 %}
                                <span class="player-goals">âš½ {{ player.goals }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if game.get('Number of Players') %}
                <div class="game-meta-detail">
                    <span>ðŸ‘¥ {{ game['Number of Players']|int }} giocatori</span>
                </div>
                {% endif %}
            </div>
        </details>
        {% endfor %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const champFilter = document.getElementById('championshipFilter');
    const seasonFilter = document.getElementById('seasonFilter');
    const gameCards = document.querySelectorAll('.game-card');
    
    function filterGames() {
        const selectedChamp = champFilter.value;
        const selectedSeason = seasonFilter.value;
        
        gameCards.forEach(card => {
            const cardChamp = card.dataset.championship;
            const cardSeason = card.dataset.season;
            
            const champMatch = !selectedChamp || cardChamp === selectedChamp;
            const seasonMatch = !selectedSeason || cardSeason === selectedSeason;
            
            if (champMatch && seasonMatch) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    champFilter.addEventListener('change', filterGames);
    seasonFilter.addEventListener('change', filterGames);
});
</script>
{% endblock %}
